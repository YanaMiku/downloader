<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Downloader Instagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            padding: 40px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #405de6;
            margin-bottom: 10px;
            font-size: 2.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        h1 i {
            color: #e1306c;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .tab-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tab {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            background: none;
            border: none;
            cursor: pointer;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #405de6;
            border-bottom: 3px solid #405de6;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-section {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .url-input {
            flex: 1;
            padding: 15px 20px;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .url-input:focus {
            border-color: #405de6;
        }
        
        .fetch-btn {
            background: linear-gradient(to right, #405de6, #5851db);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(64, 93, 230, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .fetch-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(64, 93, 230, 0.4);
        }
        
        .fetch-btn:active {
            transform: translateY(1px);
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            color: #405de6;
        }
        
        .loading i {
            margin-right: 10px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-container {
            display: none;
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e0e0;
        }
        
        .metadata {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #405de6, #e1306c);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .username {
            font-weight: 600;
            font-size: 1.4rem;
            color: #333;
        }
        
        .caption {
            margin-bottom: 20px;
            line-height: 1.6;
            color: #555;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            border-left: 4px solid #405de6;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat i {
            color: #e1306c;
        }
        
        .media-preview {
            width: 100%;
            max-height: 400px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 25px;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
        }
        
        .media-preview video, .media-preview img {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: contain;
        }
        
        .media-preview.audio-preview {
            padding: 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            flex-direction: column;
        }
        
        .audio-icon {
            font-size: 4rem;
            color: #405de6;
            margin-bottom: 20px;
        }
        
        .audio-title {
            font-size: 1.2rem;
            color: #333;
            font-weight: 600;
        }
        
        .download-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        .download-btn {
            background: linear-gradient(to right, #405de6, #5851db);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }
        
        .download-btn:hover {
            background: linear-gradient(to right, #344ab9, #4841c2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(64, 93, 230, 0.3);
        }
        
        .download-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .download-btn.video-btn {
            background: linear-gradient(to right, #405de6, #833ab4);
        }
        
        .download-btn.image-btn {
            background: linear-gradient(to right, #e1306c, #fd1d1d);
        }
        
        .download-btn.audio-btn {
            background: linear-gradient(to right, #00c6ff, #0072ff);
        }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
            font-weight: 600;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        
        .example-url {
            margin-top: 15px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .example-url a {
            color: #405de6;
            text-decoration: none;
        }
        
        .example-url a:hover {
            text-decoration: underline;
        }
        
        .download-progress {
            display: none;
            margin: 15px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #405de6, #5851db);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
        }
        
        .format-options {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .format-btn {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .format-btn:hover {
            background: #e9ecef;
        }
        
        .format-btn.active {
            background: #405de6;
            color: white;
            border-color: #405de6;
        }
        
        footer {
            margin-top: 30px;
            color: white;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .file-size {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 25px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .fetch-btn {
                width: 100%;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .download-btn {
                min-width: 100%;
            }
            
            .caption {
                max-height: 150px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fab fa-instagram"></i> Instagram Downloader</h1>
            <p class="subtitle">Download video, gambar, dan audio dari Instagram dengan mudah dan cepat</p>
        </header>
        
        <div class="tab-container">
            <button class="tab active" data-tab="instagram">Instagram</button>
            <button class="tab" data-tab="coming-soon">Coming Soon</button>
        </div>
        
        <div class="tab-content active" id="instagram-tab">
            <div class="input-section">
                <h2 style="margin-bottom: 20px; color: #405de6;">Paste URL Instagram</h2>
                <div class="input-group">
                    <input type="text" class="url-input" id="instagramUrl" placeholder="https://www.instagram.com/p/... atau https://www.instagram.com/reel/...">
                    <button class="fetch-btn" id="fetchBtn">
                        <i class="fas fa-search"></i> Dapatkan Media
                    </button>
                </div>
                <div class="example-url">
                    Contoh URL: 
                    <a href="javascript:void(0);" id="exampleUrl">https://www.instagram.com/reel/DTARI5hCXD3/</a>
                </div>
            </div>
            
            <div class="loading" id="loadingIndicator">
                <i class="fas fa-spinner"></i> Sedang mengambil data dari Instagram...
            </div>
            
            <div class="message" id="successMessage">
                <i class="fas fa-check-circle"></i> <span id="successText">Data berhasil diambil!</span>
            </div>
            
            <div class="message error" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i> <span id="errorText">Terjadi kesalahan. Silakan coba lagi.</span>
            </div>
            
            <div class="message warning" id="warningMessage">
                <i class="fas fa-exclamation-triangle"></i> <span id="warningText"></span>
            </div>
            
            <div class="download-progress" id="downloadProgress">
                <div class="progress-text">Mengunduh: <span id="progressPercent">0%</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            
            <div class="result-container" id="resultContainer">
                <div class="metadata">
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">E</div>
                        <div>
                            <div class="username" id="username">exabytes_id</div>
                            <div id="postType" style="color: #666; font-size: 0.9rem;">Video Post</div>
                        </div>
                    </div>
                    
                    <div class="caption" id="caption">
                        Pantes gerd sering kambuh, makanan sehari-harinya "itu" sih.. ðŸ¥¹

                        #ItMemes #CodingMemes #ProgrammerIndonesia
                    </div>
                    
                    <div class="stats">
                        <div class="stat">
                            <i class="fas fa-heart"></i>
                            <span id="likeCount">4,174</span> likes
                        </div>
                        <div class="stat">
                            <i class="fas fa-comment"></i>
                            <span id="commentCount">120</span> comments
                        </div>
                        <div class="stat">
                            <i class="fas fa-play-circle"></i>
                            <span id="mediaType">Video</span>
                        </div>
                    </div>
                </div>
                
                <div class="media-preview" id="mediaPreview">
                    <!-- Media akan ditampilkan di sini -->
                </div>
                
                <div class="download-options" id="downloadOptions">
                    <!-- Tombol download akan ditambahkan di sini -->
                </div>
                
                <div class="format-options" id="formatOptions">
                    <!-- Opsi format file akan ditambahkan di sini -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="coming-soon-tab">
            <div style="text-align: center; padding: 50px 20px;">
                <i class="fas fa-tools" style="font-size: 4rem; color: #405de6; margin-bottom: 20px;"></i>
                <h2 style="color: #405de6; margin-bottom: 15px;">Fitur Segera Hadir</h2>
                <p style="color: #666; line-height: 1.6; max-width: 600px; margin: 0 auto;">
                    Kami sedang mengembangkan fitur downloader untuk platform media sosial lainnya seperti TikTok, YouTube, Twitter, dan lainnya. Nantikan update terbaru!
                </p>
                <div style="display: flex; justify-content: center; gap: 20px; margin-top: 30px; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <i class="fab fa-tiktok" style="font-size: 2.5rem; color: #000;"></i>
                        <p style="margin-top: 10px; font-weight: 600;">TikTok</p>
                    </div>
                    <div style="text-align: center;">
                        <i class="fab fa-youtube" style="font-size: 2.5rem; color: #FF0000;"></i>
                        <p style="margin-top: 10px; font-weight: 600;">YouTube</p>
                    </div>
                    <div style="text-align: center;">
                        <i class="fab fa-twitter" style="font-size: 2.5rem; color: #1DA1F2;"></i>
                        <p style="margin-top: 10px; font-weight: 600;">Twitter</p>
                    </div>
                    <div style="text-align: center;">
                        <i class="fab fa-facebook" style="font-size: 2.5rem; color: #1877F2;"></i>
                        <p style="margin-top: 10px; font-weight: 600;">Facebook</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Instagram Downloader &copy; 2023 | Menggunakan API dari nekolabs.web.id</p>
        <p style="margin-top: 5px; font-size: 0.8rem;">Gunakan untuk keperluan pribadi dan menghormati hak cipta</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Element references
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const fetchBtn = document.getElementById('fetchBtn');
            const instagramUrlInput = document.getElementById('instagramUrl');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const warningMessage = document.getElementById('warningMessage');
            const resultContainer = document.getElementById('resultContainer');
            const exampleUrl = document.getElementById('exampleUrl');
            const downloadProgress = document.getElementById('downloadProgress');
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');
            const formatOptions = document.getElementById('formatOptions');
            
            // API endpoint
            const API_BASE_URL = 'https://api.nekolabs.web.id/downloader/instagram';
            
            // State variables
            let currentDownloadUrls = [];
            let currentMetadata = {};
            let isDownloading = false;
            let selectedFormat = 'original';
            
            // Tab switching functionality
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show active content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Example URL click
            exampleUrl.addEventListener('click', () => {
                instagramUrlInput.value = exampleUrl.textContent;
            });
            
            // Fetch Instagram media data
            fetchBtn.addEventListener('click', fetchInstagramData);
            
            // Allow Enter key to trigger fetch
            instagramUrlInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    fetchInstagramData();
                }
            });
            
            async function fetchInstagramData() {
                const url = instagramUrlInput.value.trim();
                
                if (!url) {
                    showError('Harap masukkan URL Instagram');
                    return;
                }
                
                // Validate URL
                if (!url.includes('instagram.com')) {
                    showError('URL harus dari Instagram (instagram.com)');
                    return;
                }
                
                // Show loading indicator
                loadingIndicator.style.display = 'block';
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';
                warningMessage.style.display = 'none';
                resultContainer.style.display = 'none';
                downloadProgress.style.display = 'none';
                formatOptions.innerHTML = '';
                
                try {
                    // Encode URL for API request
                    const encodedUrl = encodeURIComponent(url);
                    const apiUrl = `${API_BASE_URL}?url=${encodedUrl}`;
                    
                    // Make API request
                    const response = await fetch(apiUrl);
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Check if API request was successful
                    if (data.success && data.result) {
                        displayInstagramData(data.result);
                        showSuccess('Data berhasil diambil dari Instagram');
                    } else {
                        throw new Error('Gagal mengambil data dari Instagram');
                    }
                } catch (error) {
                    console.error('Error fetching Instagram data:', error);
                    
                    // For demo purposes, show example data if API fails
                    if (url.includes('example') || url.includes('reel/DTARI5hCXD3')) {
                        displayExampleData();
                        showSuccess('Data berhasil diambil (contoh data)');
                    } else {
                        showError(`Gagal mengambil data: ${error.message}. Coba lagi atau gunakan URL contoh.`);
                    }
                } finally {
                    loadingIndicator.style.display = 'none';
                }
            }
            
            function displayInstagramData(result) {
                const metadata = result.metadata;
                const downloadUrls = result.downloadUrl;
                currentDownloadUrls = downloadUrls;
                currentMetadata = metadata;
                
                // Update user info
                document.getElementById('username').textContent = metadata.username;
                document.getElementById('userAvatar').textContent = metadata.username.charAt(0).toUpperCase();
                
                // Update caption
                document.getElementById('caption').textContent = metadata.caption || 'Tidak ada caption';
                
                // Update stats
                document.getElementById('likeCount').textContent = metadata.like.toLocaleString();
                document.getElementById('commentCount').textContent = metadata.comment.toLocaleString();
                
                // Update media type
                const mediaType = metadata.isVideo ? 'Video' : 'Gambar';
                document.getElementById('mediaType').textContent = mediaType;
                document.getElementById('postType').textContent = metadata.isVideo ? 'Video Post' : 'Image Post';
                
                // Clear previous media preview and download options
                const mediaPreview = document.getElementById('mediaPreview');
                const downloadOptions = document.getElementById('downloadOptions');
                mediaPreview.innerHTML = '';
                downloadOptions.innerHTML = '';
                
                // Determine file type based on URL extension
                const fileType = determineFileType(downloadUrls[0]);
                
                // Display media preview
                if (metadata.isVideo || fileType === 'video') {
                    // For video
                    const videoElement = document.createElement('video');
                    videoElement.controls = true;
                    videoElement.preload = 'metadata';
                    videoElement.style.width = '100%';
                    videoElement.style.maxHeight = '400px';
                    
                    const sourceElement = document.createElement('source');
                    sourceElement.src = downloadUrls[0];
                    sourceElement.type = 'video/mp4';
                    
                    videoElement.appendChild(sourceElement);
                    mediaPreview.appendChild(videoElement);
                    
                    // Create download button for video
                    const downloadBtn = createDownloadButton('Download Video', downloadUrls[0], 'video', 0, 'MP4');
                    downloadOptions.appendChild(downloadBtn);
                    
                    // Add format options for video
                    addFormatOptions(['MP4', 'WebM', 'MOV'], 'video');
                    
                } else if (fileType === 'audio') {
                    // For audio
                    mediaPreview.className = 'media-preview audio-preview';
                    mediaPreview.innerHTML = `
                        <i class="fas fa-music audio-icon"></i>
                        <div class="audio-title">Audio Instagram</div>
                        <div style="color: #666; margin-top: 10px;">Klik tombol di bawah untuk mendownload audio</div>
                    `;
                    
                    // Create download button for audio
                    const downloadBtn = createDownloadButton('Download Audio', downloadUrls[0], 'audio', 0, 'MP3');
                    downloadOptions.appendChild(downloadBtn);
                    
                    // Add format options for audio
                    addFormatOptions(['MP3', 'WAV', 'M4A'], 'audio');
                    
                } else {
                    // For images (could be multiple)
                    mediaPreview.className = 'media-preview';
                    downloadUrls.forEach((url, index) => {
                        const imgElement = document.createElement('img');
                        imgElement.src = url;
                        imgElement.alt = `Instagram image ${index + 1}`;
                        imgElement.style.width = '100%';
                        imgElement.style.maxHeight = '400px';
                        imgElement.style.objectFit = 'contain';
                        
                        // Add error handling for image
                        imgElement.onerror = function() {
                            this.style.display = 'none';
                            mediaPreview.innerHTML = `<div style="padding: 30px; text-align: center; color: #666;">
                                <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 15px; color: #ccc;"></i>
                                <div>Gambar tidak dapat dimuat. Silakan gunakan tombol download.</div>
                            </div>`;
                        };
                        
                        mediaPreview.appendChild(imgElement);
                        
                        // Create download button for each image
                        const downloadBtn = createDownloadButton(
                            downloadUrls.length > 1 ? `Download Gambar ${index + 1}` : 'Download Gambar',
                            url,
                            'image',
                            index,
                            'JPG'
                        );
                        downloadOptions.appendChild(downloadBtn);
                    });
                    
                    // Add format options for images
                    addFormatOptions(['JPG', 'PNG', 'WebP'], 'image');
                }
                
                // Show result container
                resultContainer.style.display = 'block';
                
                // Scroll to result container
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            }
            
            function determineFileType(url) {
                const extension = url.split('.').pop().toLowerCase().split('?')[0];
                
                // Video extensions
                const videoExtensions = ['mp4', 'webm', 'mov', 'avi', 'mkv', 'flv', 'wmv', 'm4v', 'mpg', 'mpeg'];
                // Audio extensions
                const audioExtensions = ['mp3', 'wav', 'm4a', 'aac', 'ogg', 'flac', 'wma'];
                // Image extensions
                const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg', 'ico'];
                
                if (videoExtensions.includes(extension)) return 'video';
                if (audioExtensions.includes(extension)) return 'audio';
                if (imageExtensions.includes(extension)) return 'image';
                
                // Check URL pattern for video
                if (url.includes('/video/') || url.includes('.mp4') || url.includes('video')) return 'video';
                
                // Default to image
                return 'image';
            }
            
            function addFormatOptions(formats, mediaType) {
                formatOptions.innerHTML = '';
                
                const formatContainer = document.createElement('div');
                formatContainer.style.width = '100%';
                formatContainer.style.marginBottom = '15px';
                
                const formatLabel = document.createElement('div');
                formatLabel.textContent = 'Pilih Format:';
                formatLabel.style.fontWeight = '600';
                formatLabel.style.marginBottom = '10px';
                formatLabel.style.color = '#405de6';
                
                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'format-options';
                
                formats.forEach(format => {
                    const formatBtn = document.createElement('button');
                    formatBtn.className = `format-btn ${format === 'JPG' || format === 'MP4' || format === 'MP3' ? 'active' : ''}`;
                    formatBtn.textContent = format;
                    formatBtn.dataset.format = format.toLowerCase();
                    
                    formatBtn.addEventListener('click', () => {
                        // Update active button
                        document.querySelectorAll('.format-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        formatBtn.classList.add('active');
                        selectedFormat = format.toLowerCase();
                        
                        // Update download buttons with new format
                        updateDownloadButtonsFormat(mediaType, format);
                    });
                    
                    buttonsContainer.appendChild(formatBtn);
                });
                
                formatContainer.appendChild(formatLabel);
                formatContainer.appendChild(buttonsContainer);
                formatOptions.appendChild(formatContainer);
            }
            
            function updateDownloadButtonsFormat(mediaType, format) {
                const downloadButtons = document.querySelectorAll('.download-btn');
                
                downloadButtons.forEach((btn, index) => {
                    const originalUrl = currentDownloadUrls[index] || currentDownloadUrls[0];
                    let newText = '';
                    
                    if (mediaType === 'video') {
                        newText = `Download Video (${format})`;
                        btn.className = 'download-btn video-btn';
                    } else if (mediaType === 'audio') {
                        newText = `Download Audio (${format})`;
                        btn.className = 'download-btn audio-btn';
                    } else {
                        newText = `Download Gambar (${format})`;
                        btn.className = 'download-btn image-btn';
                    }
                    
                    // Update button text
                    const icon = btn.querySelector('i') ? btn.querySelector('i').outerHTML : '<i class="fas fa-download"></i>';
                    btn.innerHTML = `${icon} ${newText}`;
                    
                    // Update button click handler with new format
                    btn.onclick = () => downloadMedia(originalUrl, mediaType, index, format);
                });
            }
            
            // Example data for demo purposes
            function displayExampleData() {
                const exampleData = {
                    metadata: {
                        caption: "Pantes gerd sering kambuh, makanan sehari-harinya \"itu\" sih.. ðŸ¥¹\n\n#ItMemes #CodingMemes #ProgrammerIndonesia",
                        username: "exabytes_id",
                        like: 4174,
                        comment: 120,
                        isVideo: true
                    },
                    downloadUrl: [
                        "https://nc-cdn.oss-us-west-1.aliyuncs.com/nekoo/1767526111333.jpg"
                    ]
                };
                
                displayInstagramData(exampleData);
            }
            
            function createDownloadButton(text, url, type, index, format) {
                const button = document.createElement('button');
                button.className = `download-btn ${type}-btn`;
                button.id = `download-btn-${index}`;
                button.innerHTML = `
                    <i class="fas fa-download"></i>
                    ${text}${format ? ` (${format})` : ''}
                `;
                
                button.addEventListener('click', () => {
                    downloadMedia(url, type, index, format);
                });
                
                return button;
            }
            
            async function downloadMedia(url, type, index, format = 'original') {
                if (isDownloading) {
                    showWarning('Sedang mengunduh file lainnya, tunggu hingga selesai.');
                    return;
                }
                
                isDownloading = true;
                const downloadBtn = document.getElementById(`download-btn-${index}`);
                const originalText = downloadBtn.innerHTML;
                
                try {
                    // Show downloading message
                    showSuccess(`Mengunduh ${type === 'video' ? 'video' : type === 'audio' ? 'audio' : 'gambar'}...`);
                    
                    // Show progress bar
                    downloadProgress.style.display = 'block';
                    progressFill.style.width = '0%';
                    progressPercent.textContent = '0%';
                    
                    // Disable download button
                    downloadBtn.disabled = true;
                    downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengunduh...';
                    
                    // Get file extension from format
                    let fileExtension = getFileExtension(type, format);
                    
                    // Create a unique filename
                    const timestamp = Date.now();
                    const username = currentMetadata.username || 'instagram';
                    const fileName = `${username}_${type}_${timestamp}.${fileExtension}`;
                    
                    // Use fetch to get the file with progress tracking
                    const response = await fetch(url, { mode: 'cors' });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    
                    const contentLength = response.headers.get('content-length');
                    const total = contentLength ? parseInt(contentLength, 10) : 0;
                    let loaded = 0;
                    
                    // Create a reader to track progress
                    const reader = response.body.getReader();
                    const chunks = [];
                    
                    // Read the stream with progress tracking
                    while (true) {
                        const { done, value } = await reader.read();
                        
                        if (done) {
                            break;
                        }
                        
                        chunks.push(value);
                        loaded += value.length;
                        
                        // Update progress
                        if (total > 0) {
                            const percent = Math.round((loaded / total) * 100);
                            progressFill.style.width = `${percent}%`;
                            progressPercent.textContent = `${percent}%`;
                        } else {
                            // If we don't know the total size, show indeterminate progress
                            const percent = Math.min(90, loaded / 1000000 * 10); // Estimate
                            progressFill.style.width = `${percent}%`;
                            progressPercent.textContent = `${Math.round(percent)}%`;
                        }
                    }
                    
                    // Combine chunks into a single blob
                    const blob = new Blob(chunks);
                    
                    // Check if we need to convert the blob to a different format
                    let finalBlob = blob;
                    let finalFileName = fileName;
                    
                    // Note: Actual format conversion would require server-side processing
                    // For demo purposes, we'll just rename the file
                    if (format !== 'original') {
                        // Update file extension based on selected format
                        finalFileName = `${username}_${type}_${timestamp}.${fileExtension}`;
                    }
                    
                    // Create download link
                    const blobUrl = window.URL.createObjectURL(finalBlob);
                    const link = document.createElement('a');
                    link.href = blobUrl;
                    link.download = finalFileName;
                    link.style.display = 'none';
                    
                    document.body.appendChild(link);
                    link.click();
                    
                    // Clean up
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(blobUrl);
                    
                    // Complete progress bar
                    progressFill.style.width = '100%';
                    progressPercent.textContent = '100%';
                    
                    // Show success message with file size
                    const fileSize = formatFileSize(blob.size);
                    showSuccess(`${type === 'video' ? 'Video' : type === 'audio' ? 'Audio' : 'Gambar'} berhasil diunduh! (${fileSize})`);
                    
                    // Hide progress bar after a delay
                    setTimeout(() => {
                        downloadProgress.style.display = 'none';
                    }, 2000);
                    
                } catch (error) {
                    console.error('Download error:', error);
                    
                    // Show error message
                    showError(`Gagal mengunduh: ${error.message}`);
                    
                    // Try alternative method
                    showWarning('Mencoba metode alternatif untuk mengunduh...');
                    
                    // Alternative method: create a direct download link
                    try {
                        const timestamp = Date.now();
                        const username = currentMetadata.username || 'instagram';
                        const fileExtension = getFileExtension(type, format);
                        const fileName = `${username}_${type}_${timestamp}.${fileExtension}`;
                        
                        // Create a link with download attribute
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = fileName;
                        link.style.display = 'none';
                        
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        showSuccess(`File sedang diunduh dengan metode alternatif.`);
                    } catch (fallbackError) {
                        console.error('Fallback download error:', fallbackError);
                        showError('Semua metode download gagal. Silakan coba lagi nanti.');
                    }
                    
                    // Hide progress bar
                    downloadProgress.style.display = 'none';
                } finally {
                    // Re-enable download button
                    downloadBtn.disabled = false;
                    downloadBtn.innerHTML = originalText;
                    isDownloading = false;
                }
            }
            
            function getFileExtension(type, format) {
                if (format !== 'original') {
                    return format.toLowerCase();
                }
                
                // Default extensions based on type
                switch(type) {
                    case 'video': return 'mp4';
                    case 'audio': return 'mp3';
                    case 'image': return 'jpg';
                    default: return 'mp4';
                }
            }
            
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            function showSuccess(message) {
                successMessage.className = 'message success';
                document.getElementById('successText').textContent = message;
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
                warningMessage.style.display = 'none';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 5000);
            }
            
            function showError(message) {
                errorMessage.className = 'message error';
                document.getElementById('errorText').textContent = message;
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                warningMessage.style.display = 'none';
                loadingIndicator.style.display = 'none';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
            }
            
            function showWarning(message) {
                warningMessage.className = 'message warning';
                document.getElementById('warningText').textContent = message;
                warningMessage.style.display = 'block';
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    warningMessage.style.display = 'none';
                }, 5000);
            }
            
            // Initialize with example data for demo
            setTimeout(() => {
                instagramUrlInput.value = "https://www.instagram.com/reel/DTARI5hCXD3/";
            }, 1000);
        });
    </script>
</body>
</html>
