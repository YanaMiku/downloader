
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Downloader Instagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            padding: 40px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #405de6;
            margin-bottom: 10px;
            font-size: 2.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        h1 i {
            color: #e1306c;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .tab-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tab {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            background: none;
            border: none;
            cursor: pointer;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #405de6;
            border-bottom: 3px solid #405de6;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-section {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .url-input {
            flex: 1;
            padding: 15px 20px;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .url-input:focus {
            border-color: #405de6;
        }
        
        .fetch-btn {
            background: linear-gradient(to right, #405de6, #5851db);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(64, 93, 230, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .fetch-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(64, 93, 230, 0.4);
        }
        
        .fetch-btn:active {
            transform: translateY(1px);
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            color: #405de6;
        }
        
        .loading i {
            margin-right: 10px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-container {
            display: none;
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e0e0;
        }
        
        .metadata {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #405de6, #e1306c);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .username {
            font-weight: 600;
            font-size: 1.4rem;
            color: #333;
        }
        
        .caption {
            margin-bottom: 20px;
            line-height: 1.6;
            color: #555;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            border-left: 4px solid #405de6;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
        }
        
        .stat i {
            color: #e1306c;
        }
        
        .media-preview-container {
            width: 100%;
            margin-bottom: 25px;
            position: relative;
        }
        
        .media-preview {
            width: 100%;
            max-height: 400px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
        }
        
        .media-preview video, .media-preview img {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: contain;
        }
        
        /* Styles for multiple images (carousel) */
        .carousel-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            border-radius: 12px;
        }
        
        .carousel-slides {
            display: flex;
            transition: transform 0.5s ease;
        }
        
        .carousel-slide {
            min-width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
        }
        
        .carousel-slide img {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: contain;
        }
        
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background-color 0.3s;
            z-index: 10;
        }
        
        .carousel-nav:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .carousel-nav.prev {
            left: 10px;
        }
        
        .carousel-nav.next {
            right: 10px;
        }
        
        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }
        
        .carousel-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #ddd;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .carousel-indicator.active {
            background-color: #405de6;
        }
        
        .download-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        .download-btn {
            background: linear-gradient(to right, #405de6, #5851db);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }
        
        .download-btn:hover {
            background: linear-gradient(to right, #344ab9, #4841c2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(64, 93, 230, 0.3);
        }
        
        .download-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .download-all-btn {
            background: linear-gradient(to right, #e1306c, #fd1d1d);
            width: 100%;
            margin-top: 10px;
        }
        
        .download-all-btn:hover {
            background: linear-gradient(to right, #c13584, #e1306c);
        }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
            font-weight: 600;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        
        .example-url {
            margin-top: 15px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .example-url a {
            color: #405de6;
            text-decoration: none;
        }
        
        .example-url a:hover {
            text-decoration: underline;
        }
        
        .download-progress {
            display: none;
            margin: 15px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #405de6, #5851db);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
        }
        
        footer {
            margin-top: 30px;
            color: white;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 25px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .fetch-btn {
                width: 100%;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .download-btn {
                min-width: 100%;
            }
            
            .carousel-nav {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fab fa-instagram"></i> Instagram Downloader</h1>
            <p class="subtitle">Download video dan gambar dari Instagram dengan mudah dan cepat</p>
        </header>
        
        <div class="tab-container">
            <button class="tab active" data-tab="instagram">Instagram</button>
            <button class="tab" data-tab="coming-soon">Coming Soon</button>
        </div>
        
        <div class="tab-content active" id="instagram-tab">
            <div class="input-section">
                <h2 style="margin-bottom: 20px; color: #405de6;">Paste URL Instagram</h2>
                <div class="input-group">
                    <input type="text" class="url-input" id="instagramUrl" placeholder="https://www.instagram.com/p/... atau https://www.instagram.com/reel/...">
                    <button class="fetch-btn" id="fetchBtn">
                        <i class="fas fa-search"></i> Dapatkan Media
                    </button>
                </div>
                <div class="example-url">
                    Contoh URL: 
                    <a href="javascript:void(0);" id="exampleUrl">https://www.instagram.com/reel/DTARI5hCXD3/</a>
                </div>
            </div>
            
            <div class="loading" id="loadingIndicator">
                <i class="fas fa-spinner"></i> Sedang mengambil data dari Instagram...
            </div>
            
            <div class="message" id="successMessage">
                <i class="fas fa-check-circle"></i> <span id="successText">Data berhasil diambil!</span>
            </div>
            
            <div class="message error" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i> <span id="errorText">Terjadi kesalahan. Silakan coba lagi.</span>
            </div>
            
            <div class="message warning" id="warningMessage">
                <i class="fas fa-exclamation-triangle"></i> <span id="warningText"></span>
            </div>
            
            <div class="download-progress" id="downloadProgress">
                <div class="progress-text">Mengunduh: <span id="progressPercent">0%</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            
            <div class="result-container" id="resultContainer">
                <div class="metadata">
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">E</div>
                        <div>
                            <div class="username" id="username">exabytes_id</div>
                            <div id="postType" style="color: #666; font-size: 0.9rem;">Video Post</div>
                        </div>
                    </div>
                    
                    <div class="caption" id="caption">
                        Pantes gerd sering kambuh, makanan sehari-harinya "itu" sih.. ðŸ¥¹

                        #ItMemes #CodingMemes #ProgrammerIndonesia
                    </div>
                    
                    <div class="stats">
                        <div class="stat">
                            <i class="fas fa-heart"></i>
                            <span id="likeCount">4,174</span> likes
                        </div>
                        <div class="stat">
                            <i class="fas fa-comment"></i>
                            <span id="commentCount">120</span> comments
                        </div>
                        <div class="stat">
                            <i class="fas fa-play-circle"></i>
                            <span id="mediaType">Video</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-images"></i>
                            <span id="mediaCount">1</span> media
                        </div>
                    </div>
                </div>
                
                <div class="media-preview-container" id="mediaPreviewContainer">
                    <!-- Media akan ditampilkan di sini -->
                </div>
                
                <div class="download-options" id="downloadOptions">
                    <!-- Tombol download akan ditambahkan di sini -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="coming-soon-tab">
            <div style="text-align: center; padding: 50px 20px;">
                <i class="fas fa-tools" style="font-size: 4rem; color: #405de6; margin-bottom: 20px;"></i>
                <h2 style="color: #405de6; margin-bottom: 15px;">Fitur Segera Hadir</h2>
                <p style="color: #666; line-height: 1.6; max-width: 600px; margin: 0 auto;">
                    Kami sedang mengembangkan fitur downloader untuk platform media sosial lainnya seperti TikTok, YouTube, Twitter, dan lainnya. Nantikan update terbaru!
                </p>
                <div style="display: flex; justify-content: center; gap: 20px; margin-top: 30px; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <i class="fab fa-tiktok" style="font-size: 2.5rem; color: #000;"></i>
                        <p style="margin-top: 10px; font-weight: 600;">TikTok</p>
                    </div>
                    <div style="text-align: center;">
                        <i class="fab fa-youtube" style="font-size: 2.5rem; color: #FF0000;"></i>
                        <p style="margin-top: 10px; font-weight: 600;">YouTube</p>
                    </div>
                    <div style="text-align: center;">
                        <i class="fab fa-twitter" style="font-size: 2.5rem; color: #1DA1F2;"></i>
                        <p style="margin-top: 10px; font-weight: 600;">Twitter</p>
                    </div>
                    <div style="text-align: center;">
                        <i class="fab fa-facebook" style="font-size: 2.5rem; color: #1877F2;"></i>
                        <p style="margin-top: 10px; font-weight: 600;">Facebook</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Instagram Downloader &copy; 2023 | Menggunakan API dari nekolabs.web.id</p>
        <p style="margin-top: 5px; font-size: 0.8rem;">Gunakan untuk keperluan pribadi dan menghormati hak cipta</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Element references
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const fetchBtn = document.getElementById('fetchBtn');
            const instagramUrlInput = document.getElementById('instagramUrl');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const warningMessage = document.getElementById('warningMessage');
            const resultContainer = document.getElementById('resultContainer');
            const exampleUrl = document.getElementById('exampleUrl');
            const downloadProgress = document.getElementById('downloadProgress');
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');
            const mediaPreviewContainer = document.getElementById('mediaPreviewContainer');
            const downloadOptions = document.getElementById('downloadOptions');
            
            // API endpoint
            const API_BASE_URL = 'https://api.nekolabs.web.id/downloader/instagram';
            
            // State variables
            let currentDownloadUrls = [];
            let currentMediaType = ''; // 'video' or 'image'
            let isDownloading = false;
            let carouselCurrentIndex = 0;
            let carouselSlides = [];
            let carouselIndicators = [];
            
            // Tab switching functionality
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show active content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Example URL click
            exampleUrl.addEventListener('click', () => {
                instagramUrlInput.value = exampleUrl.textContent;
            });
            
            // Fetch Instagram media data
            fetchBtn.addEventListener('click', fetchInstagramData);
            
            // Allow Enter key to trigger fetch
            instagramUrlInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    fetchInstagramData();
                }
            });
            
            async function fetchInstagramData() {
                const url = instagramUrlInput.value.trim();
                
                if (!url) {
                    showError('Harap masukkan URL Instagram');
                    return;
                }
                
                // Validate URL
                if (!url.includes('instagram.com')) {
                    showError('URL harus dari Instagram (instagram.com)');
                    return;
                }
                
                // Show loading indicator
                loadingIndicator.style.display = 'block';
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';
                warningMessage.style.display = 'none';
                resultContainer.style.display = 'none';
                downloadProgress.style.display = 'none';
                
                try {
                    // Encode URL for API request
                    const encodedUrl = encodeURIComponent(url);
                    const apiUrl = `${API_BASE_URL}?url=${encodedUrl}`;
                    
                    // Make API request
                    const response = await fetch(apiUrl);
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Check if API request was successful
                    if (data.success && data.result) {
                        displayInstagramData(data.result);
                        showSuccess('Data berhasil diambil dari Instagram');
                    } else {
                        throw new Error('Gagal mengambil data dari Instagram');
                    }
                } catch (error) {
                    console.error('Error fetching Instagram data:', error);
                    
                    // For demo purposes, show example data if API fails
                    if (url.includes('example') || url.includes('reel/DTARI5hCXD3')) {
                        displayExampleData();
                        showSuccess('Data berhasil diambil (contoh data)');
                    } else {
                        showError(`Gagal mengambil data: ${error.message}. Coba lagi atau gunakan URL contoh.`);
                    }
                } finally {
                    loadingIndicator.style.display = 'none';
                }
            }
            
            function displayInstagramData(result) {
                const metadata = result.metadata;
                const downloadUrls = result.downloadUrl;
                currentDownloadUrls = downloadUrls;
                currentMediaType = metadata.isVideo ? 'video' : 'image';
                
                // Update user info
                document.getElementById('username').textContent = metadata.username;
                document.getElementById('userAvatar').textContent = metadata.username.charAt(0).toUpperCase();
                
                // Update caption
                document.getElementById('caption').textContent = metadata.caption || 'Tidak ada caption';
                
                // Update stats
                document.getElementById('likeCount').textContent = metadata.like.toLocaleString();
                document.getElementById('commentCount').textContent = metadata.comment.toLocaleString();
                document.getElementById('mediaCount').textContent = downloadUrls.length;
                
                // Update media type
                const mediaType = metadata.isVideo ? 'Video' : 'Gambar';
                document.getElementById('mediaType').textContent = mediaType;
                document.getElementById('postType').textContent = metadata.isVideo ? 'Video Post' : `Image Post (${downloadUrls.length} gambar)` ;
                
                // Clear previous media preview and download options
                mediaPreviewContainer.innerHTML = '';
                downloadOptions.innerHTML = '';
                
                // Display media preview
                if (metadata.isVideo) {
                    // For video - single video preview
                    displayVideoPreview(downloadUrls[0]);
                    
                    // Create download button for video
                    const downloadBtn = createDownloadButton('Download Video', downloadUrls[0], 'video', 0);
                    downloadOptions.appendChild(downloadBtn);
                } else {
                    // For images - could be multiple (carousel)
                    displayImageCarousel(downloadUrls);
                    
                    // Create download buttons for each image
                    if (downloadUrls.length === 1) {
                        // Single image
                        const downloadBtn = createDownloadButton('Download Gambar', downloadUrls[0], 'image', 0);
                        downloadOptions.appendChild(downloadBtn);
                    } else {
                        // Multiple images - create button for each and a download all button
                        for (let i = 0; i < downloadUrls.length; i++) {
                            const downloadBtn = createDownloadButton(`Download Gambar ${i + 1}`, downloadUrls[i], 'image', i);
                            downloadOptions.appendChild(downloadBtn);
                        }
                        
                        // Add "Download Semua" button
                        const downloadAllBtn = document.createElement('button');
                        downloadAllBtn.className = 'download-btn download-all-btn';
                        downloadAllBtn.id = 'download-all-btn';
                        downloadAllBtn.innerHTML = `
                            <i class="fas fa-download"></i>
                            Download Semua Gambar (${downloadUrls.length})
                        `;
                        
                        downloadAllBtn.addEventListener('click', () => {
                            downloadAllImages(downloadUrls);
                        });
                        
                        downloadOptions.appendChild(downloadAllBtn);
                    }
                }
                
                // Show result container
                resultContainer.style.display = 'block';
                
                // Scroll to result container
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            }
            
            function displayVideoPreview(videoUrl) {
                const videoContainer = document.createElement('div');
                videoContainer.className = 'media-preview';
                
                const videoElement = document.createElement('video');
                videoElement.controls = true;
                videoElement.preload = 'metadata';
                videoElement.style.width = '100%';
                videoElement.style.maxHeight = '400px';
                
                const sourceElement = document.createElement('source');
                sourceElement.src = videoUrl;
                sourceElement.type = 'video/mp4';
                
                videoElement.appendChild(sourceElement);
                videoContainer.appendChild(videoElement);
                mediaPreviewContainer.appendChild(videoContainer);
            }
            
            function displayImageCarousel(imageUrls) {
                if (imageUrls.length === 1) {
                    // Single image - simple display
                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'media-preview';
                    
                    const imgElement = document.createElement('img');
                    imgElement.src = imageUrls[0];
                    imgElement.alt = 'Instagram image';
                    imgElement.style.width = '100%';
                    imgElement.style.maxHeight = '400px';
                    imgElement.style.objectFit = 'contain';
                    
                    imageContainer.appendChild(imgElement);
                    mediaPreviewContainer.appendChild(imageContainer);
                } else {
                    // Multiple images - carousel
                    const carouselContainer = document.createElement('div');
                    carouselContainer.className = 'carousel-container';
                    carouselContainer.id = 'carousel-container';
                    
                    // Create slides container
                    const slidesContainer = document.createElement('div');
                    slidesContainer.className = 'carousel-slides';
                    slidesContainer.id = 'carousel-slides';
                    
                    // Create slides
                    imageUrls.forEach((url, index) => {
                        const slide = document.createElement('div');
                        slide.className = 'carousel-slide';
                        slide.dataset.index = index;
                        
                        const imgElement = document.createElement('img');
                        imgElement.src = url;
                        imgElement.alt = `Instagram image ${index + 1}`;
                        imgElement.loading = 'lazy';
                        
                        slide.appendChild(imgElement);
                        slidesContainer.appendChild(slide);
                    });
                    
                    carouselContainer.appendChild(slidesContainer);
                    
                    // Create navigation buttons
                    if (imageUrls.length > 1) {
                        const prevButton = document.createElement('button');
                        prevButton.className = 'carousel-nav prev';
                        prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
                        prevButton.addEventListener('click', () => navigateCarousel(-1));
                        
                        const nextButton = document.createElement('button');
                        nextButton.className = 'carousel-nav next';
                        nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
                        nextButton.addEventListener('click', () => navigateCarousel(1));
                        
                        carouselContainer.appendChild(prevButton);
                        carouselContainer.appendChild(nextButton);
                        
                        // Create indicators
                        const indicatorsContainer = document.createElement('div');
                        indicatorsContainer.className = 'carousel-indicators';
                        
                        imageUrls.forEach((_, index) => {
                            const indicator = document.createElement('div');
                            indicator.className = `carousel-indicator ${index === 0 ? 'active' : ''}`;
                            indicator.dataset.index = index;
                            indicator.addEventListener('click', () => goToCarouselSlide(index));
                            
                            indicatorsContainer.appendChild(indicator);
                        });
                        
                        mediaPreviewContainer.appendChild(carouselContainer);
                        mediaPreviewContainer.appendChild(indicatorsContainer);
                        
                        // Initialize carousel state
                        carouselCurrentIndex = 0;
                        carouselSlides = Array.from(slidesContainer.children);
                        carouselIndicators = Array.from(indicatorsContainer.children);
                    } else {
                        mediaPreviewContainer.appendChild(carouselContainer);
                    }
                }
            }
            
            function navigateCarousel(direction) {
                const slidesContainer = document.getElementById('carousel-slides');
                if (!slidesContainer) return;
                
                const totalSlides = slidesContainer.children.length;
                carouselCurrentIndex = (carouselCurrentIndex + direction + totalSlides) % totalSlides;
                
                updateCarousel();
            }
            
            function goToCarouselSlide(index) {
                const slidesContainer = document.getElementById('carousel-slides');
                if (!slidesContainer || index < 0 || index >= slidesContainer.children.length) return;
                
                carouselCurrentIndex = index;
                updateCarousel();
            }
            
            function updateCarousel() {
                const slidesContainer = document.getElementById('carousel-slides');
                if (!slidesContainer) return;
                
                // Update slide position
                slidesContainer.style.transform = `translateX(-${carouselCurrentIndex * 100}%)`;
                
                // Update indicators
                if (carouselIndicators.length > 0) {
                    carouselIndicators.forEach((indicator, index) => {
                        if (index === carouselCurrentIndex) {
                            indicator.classList.add('active');
                        } else {
                            indicator.classList.remove('active');
                        }
                    });
                }
            }
            
            // Example data for demo purposes
            function displayExampleData() {
                const exampleData = {
                    metadata: {
                        caption: "Pantes gerd sering kambuh, makanan sehari-harinya \"itu\" sih.. ðŸ¥¹\n\n#ItMemes #CodingMemes #ProgrammerIndonesia",
                        username: "exabytes_id",
                        like: 4174,
                        comment: 120,
                        isVideo: true
                    },
                    downloadUrl: [
                        "https://nc-cdn.oss-us-west-1.aliyuncs.com/nekoo/1767526111333.jpg",
                        "https://nc-cdn.oss-us-west-1.aliyuncs.com/nekoo/1767526111333.jpg",
                        "https://nc-cdn.oss-us-west-1.aliyuncs.com/nekoo/1767526111333.jpg"
                    ]
                };
                
                // For demo, we'll set isVideo to false to show image carousel
                exampleData.metadata.isVideo = false;
                
                displayInstagramData(exampleData);
            }
            
            function createDownloadButton(text, url, type, index) {
                const button = document.createElement('button');
                button.className = 'download-btn';
                button.id = `download-btn-${index}`;
                button.innerHTML = `
                    <i class="fas fa-download"></i>
                    ${text}
                `;
                
                button.addEventListener('click', () => {
                    downloadMedia(url, type, index);
                });
                
                return button;
            }
            
            async function downloadMedia(url, type, index) {
                if (isDownloading) {
                    showWarning('Sedang mengunduh file lainnya, tunggu hingga selesai.');
                    return;
                }
                
                isDownloading = true;
                const downloadBtn = document.getElementById(`download-btn-${index}`);
                const originalText = downloadBtn ? downloadBtn.innerHTML : '';
                
                if (downloadBtn) {
                    downloadBtn.disabled = true;
                    downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengunduh...';
                }
                
                try {
                    // Show downloading message
                    showSuccess(`Mengunduh ${type === 'video' ? 'video' : 'gambar'}...`);
                    
                    // Show progress bar
                    downloadProgress.style.display = 'block';
                    progressFill.style.width = '0%';
                    progressPercent.textContent = '0%';
                    
                    // Fetch the media file with progress tracking
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    
                    const contentLength = response.headers.get('content-length');
                    const total = contentLength ? parseInt(contentLength, 10) : null;
                    let loaded = 0;
                    
                    // Get the response as a stream for progress tracking
                    const reader = response.body.getReader();
                    const chunks = [];
                    
                    while (true) {
                        const { done, value } = await reader.read();
                        
                        if (done) {
                            break;
                        }
                        
                        chunks.push(value);
                        loaded += value.length;
                        
                        // Update progress if we know the total size
                        if (total) {
                            const percent = Math.round((loaded / total) * 100);
                            progressFill.style.width = `${percent}%`;
                            progressPercent.textContent = `${percent}%`;
                        } else {
                            // If we don't know the total size, show indeterminate progress
                            const percent = Math.min(95, Math.round(loaded / 100000)); // Approximate
                            progressFill.style.width = `${percent}%`;
                            progressPercent.textContent = `${percent}%`;
                        }
                    }
                    
                    // Combine chunks into a single blob
                    const blob = new Blob(chunks);
                    
                    // Generate filename
                    const timestamp = new Date().getTime();
                    const fileExtension = type === 'video' ? 'mp4' : 'jpg';
                    const filename = type === 'video' 
                        ? `instagram_video_${timestamp}.${fileExtension}`
                        : `instagram_image_${index + 1}_${timestamp}.${fileExtension}`;
                    
                    // Create download link
                    const link = document.createElement('a');
                    const blobUrl = URL.createObjectURL(blob);
                    link.href = blobUrl;
                    link.download = filename;
                    link.style.display = 'none';
                    
                    document.body.appendChild(link);
                    link.click();
                    
                    // Clean up
                    document.body.removeChild(link);
                    URL.revokeObjectURL(blobUrl);
                    
                    // Complete progress bar
                    progressFill.style.width = '100%';
                    progressPercent.textContent = '100%';
                    
                    // Show success message
                    showSuccess(`${type === 'video' ? 'Video' : 'Gambar'} berhasil diunduh!`);
                    
                    // Hide progress bar after a delay
                    setTimeout(() => {
                        downloadProgress.style.display = 'none';
                    }, 2000);
                    
                } catch (error) {
                    console.error('Download error:', error);
                    
                    // Show error message
                    showError(`Gagal mengunduh: ${error.message}`);
                    
                    // Try fallback method - direct download
                    try {
                        showWarning('Mencoba metode alternatif...');
                        
                        const timestamp = new Date().getTime();
                        const fileExtension = type === 'video' ? 'mp4' : 'jpg';
                        const filename = type === 'video' 
                            ? `instagram_video_${timestamp}.${fileExtension}`
                            : `instagram_image_${index + 1}_${timestamp}.${fileExtension}`;
                        
                        // Create a simple download link
                        const fallbackLink = document.createElement('a');
                        fallbackLink.href = url;
                        fallbackLink.download = filename;
                        fallbackLink.style.display = 'none';
                        
                        document.body.appendChild(fallbackLink);
                        fallbackLink.click();
                        document.body.removeChild(fallbackLink);
                        
                        showSuccess(`Metode alternatif berhasil. ${type === 'video' ? 'Video' : 'Gambar'} sedang diunduh.`);
                    } catch (fallbackError) {
                        console.error('Fallback download error:', fallbackError);
                        showError('Semua metode unduh gagal. Coba salin URL dan buka di browser.');
                    }
                } finally {
                    // Re-enable download button
                    if (downloadBtn) {
                        downloadBtn.disabled = false;
                        downloadBtn.innerHTML = originalText;
                    }
                    isDownloading = false;
                }
            }
            
            async function downloadAllImages(imageUrls) {
                if (isDownloading) {
                    showWarning('Sedang mengunduh file lainnya, tunggu hingga selesai.');
                    return;
                }
                
                isDownloading = true;
                const downloadAllBtn = document.getElementById('download-all-btn');
                const originalText = downloadAllBtn ? downloadAllBtn.innerHTML : '';
                
                if (downloadAllBtn) {
                    downloadAllBtn.disabled = true;
                    downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengunduh semua...';
                }
                
                try {
                    showSuccess(`Mengunduh ${imageUrls.length} gambar...`);
                    
                    // Show progress bar
                    downloadProgress.style.display = 'block';
                    progressFill.style.width = '0%';
                    progressPercent.textContent = '0%';
                    
                    // Create a zip file using JSZip library (simulated)
                    // Note: In a real implementation, you would use a library like JSZip
                    // For simplicity, we'll download each image separately
                    
                    for (let i = 0; i < imageUrls.length; i++) {
                        const url = imageUrls[i];
                        
                        // Update progress
                        const percent = Math.round((i / imageUrls.length) * 100);
                        progressFill.style.width = `${percent}%`;
                        progressPercent.textContent = `${percent}%`;
                        
                        // Download each image
                        await downloadSingleImage(url, i, imageUrls.length);
                        
                        // Small delay between downloads
                        if (i < imageUrls.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 500));
                        }
                    }
                    
                    // Complete progress
                    progressFill.style.width = '100%';
                    progressPercent.textContent = '100%';
                    
                    showSuccess(`Semua ${imageUrls.length} gambar berhasil diunduh!`);
                    
                    // Hide progress bar after a delay
                    setTimeout(() => {
                        downloadProgress.style.display = 'none';
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error downloading all images:', error);
                    showError(`Gagal mengunduh semua gambar: ${error.message}`);
                } finally {
                    // Re-enable download button
                    if (downloadAllBtn) {
                        downloadAllBtn.disabled = false;
                        downloadAllBtn.innerHTML = originalText;
                    }
                    isDownloading = false;
                }
            }
            
            async function downloadSingleImage(url, index, total) {
                try {
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    
                    const blob = await response.blob();
                    const timestamp = new Date().getTime();
                    const filename = `instagram_image_${index + 1}_${timestamp}.jpg`;
                    
                    // Create download link
                    const link = document.createElement('a');
                    const blobUrl = URL.createObjectURL(blob);
                    link.href = blobUrl;
                    link.download = filename;
                    link.style.display = 'none';
                    
                    document.body.appendChild(link);
                    link.click();
                    
                    // Clean up
                    document.body.removeChild(link);
                    URL.revokeObjectURL(blobUrl);
                    
                } catch (error) {
                    console.error(`Error downloading image ${index + 1}:`, error);
                    throw error;
                }
            }
            
            function showSuccess(message) {
                successMessage.className = 'message success';
                document.getElementById('successText').textContent = message;
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
                warningMessage.style.display = 'none';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 5000);
            }
            
            function showError(message) {
                errorMessage.className = 'message error';
                document.getElementById('errorText').textContent = message;
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                warningMessage.style.display = 'none';
                loadingIndicator.style.display = 'none';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
            }
            
            function showWarning(message) {
                warningMessage.className = 'message warning';
                document.getElementById('warningText').textContent = message;
                warningMessage.style.display = 'block';
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    warningMessage.style.display = 'none';
                }, 5000);
            }
            
            // Initialize with example data for demo
            setTimeout(() => {
                instagramUrlInput.value = "https://www.instagram.com/reel/DTARI5hCXD3/";
            }, 1000);
        });
    </script>
</body>
</html>
